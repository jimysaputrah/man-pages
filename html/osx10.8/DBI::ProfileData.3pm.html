<!DOCTYPE html>
<html>
    <head>
        <meta name="description" content="This module offers the ability to read, manipulate and format..." />
        <meta http-equiv="Content-Type" CONTENT="text/html; charset="utf-8" />
        <script type="text/javascript" src="../js/ga.js"></script>
        <title>DBI::ProfileData - manipulate DBI::ProfileDumper data dumps</title>
        <META NAME="robots" CONTENT="all" />
    </head>
    
<body><pre>

DBI::ProfileData(3)   User Contributed Perl Documentation  DBI::ProfileData(3)



NAME
       DBI::ProfileData - manipulate DBI::ProfileDumper data dumps

SYNOPSIS
       The easiest way to use this module is through the dbiprof frontend (see
       dbiprof for details):

	 dbiprof --number 15 --sort count

       This module can also be used to roll your own profile analysis:

	 # load data from dbi.prof
	 $prof = DBI::ProfileData-&gtnew(File =&gt "dbi.prof");

	 # get a count of the records (unique paths) in the data set
	 $count = $prof-&gtcount();

	 # sort by longest overall time
	 $prof-&gtsort(field =&gt "longest");

	 # sort by longest overall time, least to greatest
	 $prof-&gtsort(field =&gt "longest", reverse =&gt 1);

	 # exclude records with key2 eq 'disconnect'
	 $prof-&gtexclude(key2 =&gt 'disconnect');

	 # exclude records with key1 matching /^UPDATE/i
	 $prof-&gtexclude(key1 =&gt qr/^UPDATE/i);

	 # remove all records except those where key1 matches /^SELECT/i
	 $prof-&gtmatch(key1 =&gt qr/^SELECT/i);

	 # produce a formatted report with the given number of items
	 $report = $prof-&gtreport(number =&gt 10);

	 # clone the profile data set
	 $clone = $prof-&gtclone();

	 # get access to hash of header values
	 $header = $prof-&gtheader();

	 # get access to sorted array of nodes
	 $nodes = $prof-&gtnodes();

	 # format a single node in the same style as report()
	 $text = $prof-&gtformat($nodes-&gt[0]);

	 # get access to Data hash in DBI::Profile format
	 $Data = $prof-&gtData();

DESCRIPTION
       This module offers the ability to read, manipulate and format
       DBI::ProfileDumper profile data.

       Conceptually, a profile consists of a series of records, or nodes, each
       of each has a set of statistics and set of keys.  Each record must have
       a unique set of keys, but there is no requirement that every record
       have the same number of keys.

METHODS
       The following methods are supported by DBI::ProfileData objects.

   $prof = DBI::ProfileData-&gtnew(File =&gt "dbi.prof")
   $prof = DBI::ProfileData-&gtnew(File =&gt "dbi.prof", Filter =&gt sub { ... })
   $prof = DBI::ProfileData-&gtnew(Files =&gt [ "dbi.prof.1", "dbi.prof.2" ])
       Creates a a new DBI::ProfileData object.  Takes either a single file
       through the File option or a list of Files in an array ref.  If
       multiple files are specified then the header data from the first file
       is used.

       Files

       Reference to an array of file names to read.

       File

       Name of file to read. Takes precedence over "Files".

       DeleteFiles

       If true, the files are deleted after being read.

       Actually the files are renamed with a C.deleteme&gt suffix before being
       read, and then, after reading all the files, they're all deleted
       together.

       The files are locked while being read which, combined with the rename,
       makes it safe to 'consume' files that are still being generated by
       DBI::ProfileDumper.

       Filter

       The "Filter" parameter can be used to supply a code reference that can
       manipulate the profile data as it is being read. This is most useful
       for editing SQL statements so that slightly different statements in the
       raw data will be merged and aggregated in the loaded data. For example:

	 Filter =&gt sub {
	     my ($path_ref, $data_ref) = @_;
	     s/foo = '.*?'/foo = '...'/ for @$path_ref;
	 }

       Here's an example that performs some normalization on the SQL. It
       converts all numbers to "N" and all quoted strings to "S".  It can also
       convert digits to N within names. Finally, it summarizes long "IN
       (...)" clauses.

       It's aggressive and simplistic, but it's often sufficient, and serves
       as an example that you can tailor to suit your own needs:

	 Filter =&gt sub {
	     my ($path_ref, $data_ref) = @_;
	     local $_ = $path_ref-&gt[0]; # whichever element contains the SQL Statement
	     s/\b\d+\b/N/g;		# 42 -&gt N
	     s/\b0x[0-9A-Fa-f]+\b/N/g;	# 0xFE -&gt N
	     s/'.*?'/'S'/g;		# single quoted strings (doesn't handle escapes)
	     s/".*?"/"S"/g;		# double quoted strings (doesn't handle escapes)
	     # convert names like log_20001231 into log_NNNNNNNN, controlled by $opt{n}
	     s/([a-z_]+)(\d{$opt{n},})/$1.('N' x length($2))/ieg if $opt{n};
	     # abbreviate massive "in (...)" statements and similar
	     s!(([NS],){100,})!sprintf("$2,{repeated %d times}",length($1)/2)!eg;
	 }

       It's often better to perform this kinds of normalization in the DBI
       while the data is being collected, to avoid too much memory being used
       by storing profile data for many different SQL statement. See
       DBI::Profile.

   $copy = $prof-&gtclone();
       Clone a profile data set creating a new object.

   $header = $prof-&gtheader();
       Returns a reference to a hash of header values.	These are the key
       value pairs included in the header section of the DBI::ProfileDumper
       data format.  For example:

	 $header = {
	   Path    =&gt [ '!Statement', '!MethodName' ],
	   Program =&gt 't/42profile_data.t',
	 };

       Note that modifying this hash will modify the header data stored inside
       the profile object.

   $nodes = $prof-&gtnodes()
       Returns a reference the sorted nodes array.  Each element in the array
       is a single record in the data set.  The first seven elements are the
       same as the elements provided by DBI::Profile.  After that each key is
       in a separate element.  For example:

	$nodes = [
		   [
		     2, 		     # 0, count
		     0.0312958955764771,     # 1, total duration
		     0.000490069389343262,   # 2, first duration
		     0.000176072120666504,   # 3, shortest duration
		     0.00140702724456787,    # 4, longest duration
		     1023115819.83019,	     # 5, time of first event
		     1023115819.86576,	     # 6, time of last event
		     'SELECT foo FROM bar'   # 7, key1
		     'execute'		     # 8, key2
					     # 6+N, keyN
		   ],
					     # ...
		 ];

       Note that modifying this array will modify the node data stored inside
       the profile object.

   $count = $prof-&gtcount()
       Returns the number of items in the profile data set.

   $prof-&gtsort(field =&gt "field")
   $prof-&gtsort(field =&gt "field", reverse =&gt 1)
       Sorts data by the given field.  Available fields are:

	 longest
	 total
	 count
	 shortest

       The default sort is greatest to smallest, which is the opposite of the
       normal Perl meaning.  This, however, matches the expected behavior of
       the dbiprof frontend.

   $count = $prof-&gtexclude(key2 =&gt "disconnect")
   $count = $prof-&gtexclude(key2 =&gt "disconnect", case_sensitive =&gt 1)
   $count = $prof-&gtexclude(key1 =&gt qr/^SELECT/i)
       Removes records from the data set that match the given string or
       regular expression.  This method modifies the data in a permanent
       fashion - use clone() first to maintain the original data after
       exclude().  Returns the number of nodes left in the profile data set.

   $count = $prof-&gtmatch(key2 =&gt "disconnect")
   $count = $prof-&gtmatch(key2 =&gt "disconnect", case_sensitive =&gt 1)
   $count = $prof-&gtmatch(key1 =&gt qr/^SELECT/i)
       Removes records from the data set that do not match the given string or
       regular expression.  This method modifies the data in a permanent
       fashion - use clone() first to maintain the original data after
       match().  Returns the number of nodes left in the profile data set.

   $Data = $prof-&gtData()
       Returns the same Data hash structure as seen in DBI::Profile.  This
       structure is not sorted.  The nodes() structure probably makes more
       sense for most analysis.

   $text = $prof-&gtformat($nodes-&gt[0])
       Formats a single node into a human-readable block of text.

   $text = $prof-&gtreport(number =&gt 10)
       Produces a report with the given number of items.

AUTHOR
       Sam Tregar &ltsam@tregar.com&gt

COPYRIGHT AND LICENSE
       Copyright (C) 2002 Sam Tregar

       This program is free software; you can redistribute it and/or modify it
       under the same terms as Perl 5 itself.



perl v5.12.4			  2007-09-27		   DBI::ProfileData(3)
    </pre></body>

</html>
